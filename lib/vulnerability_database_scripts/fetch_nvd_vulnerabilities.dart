import 'dart:convert';
import 'dart:io';
import 'package:http/http.dart' as http;

Future<void> fetchAndSaveNvdData() async {
  final baseUrl = 'https://services.nvd.nist.gov/rest/json/cves/2.0';
  final keywords = ['dart', 'flutter'];
  final outputFilePath = 'nvd_vulnerabilities.json';

  List<dynamic> combinedResults = [];

  for (String keyword in keywords) {
    final url = '$baseUrl?keywordSearch=$keyword';
    print('Fetching NVD data for keyword: $keyword');
    try {
      final response = await http.get(Uri.parse(url));
      if (response.statusCode == 200) {
        final data = jsonDecode(response.body);
        if (data['vulnerabilities'] != null) {
          combinedResults.addAll(data['vulnerabilities']);
        }
      } else {
        print('Failed to fetch data for keyword "$keyword". Status Code: ${response.statusCode}');
      }
    } catch (e) {
      print('Error fetching NVD data for keyword "$keyword": $e');
    }
  }

  // Save combined results to a file
  try {
    final file = File(outputFilePath);
    await file.writeAsString(jsonEncode(combinedResults), flush: true);
    print('Combined NVD data saved to $outputFilePath');
  } catch (e) {
    print('Error saving NVD data to file: $e');
  }
}

void main() async {
  await fetchAndSaveNvdData();
}